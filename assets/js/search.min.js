var metadata;var autoCompleteShowing=false;var displayingAutcompleteResults=[];var autoCompleteShowingID=0;var lastSearch="";var autoCompleteResultLimit=3;var results=[];var scoreForTitleMatch=10;var scoreForURLMatch=5;var scoreForKeywordMatch=3;var scoreForDescriptionMatch=1;function addResult(c,b,f,g,e){var d=(b*scoreForTitleMatch)+(f*scoreForDescriptionMatch)+(g*scoreForURLMatch)+(e*scoreForKeywordMatch);if(d>0){var a=results.length;results[a]=[];results[a].topic=c;results[a].score=d}}function loadPage(a){window.location.replace(a);window.location.href=a}$(document).on("keypress",function(a){if(a.keyCode==13){if(autoCompleteShowing){a.preventDefault()}}});function highlightMe(b,a){b=String(b);simpletext=new RegExp("("+a+")","gi");return b.replace(simpletext,"<span style='background-color:yellow'>$1</span>")}function matches(c,b){var a=c.split(b);return a.length-1}function hookupTOCEvents(){$(".expand-menu").on("click",function(a){menu=a.currentTarget.parentElement;if(menu.classList.contains("menu-closed")){menu.classList.remove("menu-closed");menu.classList.add("menu-open")}else{menu.classList.add("menu-closed");menu.classList.remove("menu-open")}return false});$(".left-off-canvas-menu").css("display","block");$("#st-search-input").on("keyup change",function(g){g=g||window.event;if(autoCompleteShowing){if(g.keyCode=="38"){if(autoCompleteShowingID>-1){$("#autoCompleteResult"+autoCompleteShowingID).removeClass("autocompleteSelected");autoCompleteShowingID=autoCompleteShowingID-1;$("#autoCompleteResult"+autoCompleteShowingID).addClass("autocompleteSelected");$("#autocompleteShowAll").removeClass("autocompleteSelected")}else{$("#autoCompleteResult0").removeClass("autocompleteSelected");autoCompleteShowingID=-1}}else{if(g.keyCode=="40"){if(autoCompleteShowingID<(displayingAutcompleteResults.length-1)){$("#autoCompleteResult"+autoCompleteShowingID).removeClass("autocompleteSelected");autoCompleteShowingID=autoCompleteShowingID+1;$("#autoCompleteResult"+autoCompleteShowingID).addClass("autocompleteSelected")}else{$("#autoCompleteResult"+autoCompleteShowingID).removeClass("autocompleteSelected");$("#autocompleteShowAll").addClass("autocompleteSelected");autoCompleteShowingID=autoCompleteResultLimit}}else{if(g.keyCode=="13"){g.preventDefault();if(autoCompleteShowingID==autoCompleteResultLimit||autoCompleteShowingID==-1||autoCompleteShowing==false){loadPage("/search?q="+$("#st-search-input").val())}else{loadPage(metadata.pages[displayingAutcompleteResults[autoCompleteShowingID]].url)}}}}}var h=$("#st-search-input").val();if(lastSearch!=h){displayingAutcompleteResults=[];results=[];var a=h.toUpperCase();if(h.length>2){for(i=0;i<metadata.pages.length;i++){var l=metadata.pages[i];var j=0,d=0,c=0,b=0;var j=matches(String(l.title).toUpperCase(),a);if(l.description!=null){d=matches(String(l.description).toUpperCase(),a)}if(l.url!=null){c=matches(String(l.url).toUpperCase(),a)}if(l.keywords!=null){b=matches(String(l.keywords).toUpperCase(),a)}addResult(i,j,d,c,b)}results.sort(function(m,e){return e.score-m.score})}if(results.length>0){autoCompleteShowingID=-1;var k=0;var f=new Array();f.push("<div id='autoContainer'>");for(i=0;i<autoCompleteResultLimit&&i<results.length;i++){displayingAutcompleteResults.push(results[i].topic);f.push("<div class='autoCompleteResult pl-10 pr-10' id='autoCompleteResult"+i+"' onclick='loadPage(\""+metadata.pages[results[i].topic].url+"\")'>");f.push("<ul class='autocompleteList'>");f.push("<li id='autoTitle"+i+"' class='autocompleteTitle'>");f.push("<a href="+metadata.pages[results[i].topic].url+">"+highlightMe(metadata.pages[results[i].topic].title,h)+"</a>");f.push("</li>");f.push("<li id='autoUrl"+i+"' class='autocompleteUrl'>");f.push(highlightMe(metadata.pages[results[i].topic].url,h));f.push("</li>");if(metadata.pages[results[i].topic].keywords){f.push("<li id='autoKeywords"+i+"' class='autocompleteKeywords'>");f.push("<b>Keywords</b>: <i>"+highlightMe(metadata.pages[results[i].topic].keywords,h)+"</i>");f.push("</li>")}if(metadata.pages[results[i].topic].description){f.push("<li id='autoDescription"+i+"' class='autocompleteDescription'>");f.push("<b>Description</b>: "+highlightMe(metadata.pages[results[i].topic].description,h));f.push("</li>")}f.push("</ul>");f.push("</div>");k++}$("#autocompleteResults").css("display","block");$("#autocompleteResults").html(f.join(""));autoCompleteShowing=true}else{$("#autocompleteResults").css("display","none");$("#autocompleteResults").html("");autoCompleteShowing=false}lastSearch=h}})}jQuery(document).ready(function(){$.getJSON("/metadata.json",function(a){metadata=a;hookupTOCEvents()})});